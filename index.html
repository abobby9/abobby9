<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>A Bobby Education 9</title>
  <style>
    :root{
      --accent:#0f62fe;
      --muted:#666;
      --maxw:1200px;
      font-family: Arial, Helvetica, sans-serif;
    }
    /* Page + background */
    body{
      margin:0;
      min-height:100vh;
      background-image: url("https://raw.githubusercontent.com/abobby9/abobby9/main/Background.png");
      background-size: cover;
      background-position: center;
      display:flex;
      justify-content:center;
      padding:28px;
    }
    .wrap{
      width:100%;
      max-width:var(--maxw);
      background: rgba(255,255,255,0.70);
      border-radius:14px;
      padding:20px;
      box-shadow: 0 22px 50px rgba(0,0,0,0.25);
    }

    /* Header */
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      background: rgba(255,255,255,0.45);
      padding:14px;
      border-radius:10px;
      margin-bottom:14px;
    }
    .logo{
      width:150px;
      height:150px;
      object-fit:contain;
      border-radius:12px;
      padding:8px;
      background:rgba(255,255,255,0.6);
      box-shadow:0 6px 18px rgba(0,0,0,0.18);
    }
    .photo{
      width:150px;
      height:150px;
      object-fit:cover;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(0,0,0,0.18);
      border:3px solid rgba(255,255,255,0.6);
    }
    .title-area{ text-align:center; flex:1; }
    h1{ margin:0; font-size:44px; color:#0b2b5a; }
    .subtitle{ margin-top:8px; font-size:16px; color:#0b2b5a; font-style:italic; }

    /* Social buttons under title */
    .social-buttons{ display:flex; justify-content:center; gap:14px; margin-top:12px; }
    .social-buttons a{
      padding:10px 18px; font-weight:700; color:white; text-decoration:none; border-radius:10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.18);
    }
    .yt-btn{ background:#FF0000; }
    .ig-btn{ background:#C13584; }

    /* Search + Filters */
    .search-container {
      width: 100%;
      display: flex;
      justify-content: center;
      margin: 16px 0;
    }
    .search-box { width:90%; max-width:700px; position:relative; }

    #searchInput {
      width: 100%;
      padding: 12px 50px 12px 18px;
      font-size: 17px;
      border-radius: 12px;
      border: 2px solid #0b2b5a;
      outline: none;
      transition: 0.2s;
      background: white;
    }
    #searchInput:focus { border-color: var(--accent); box-shadow:0 0 12px rgba(15,98,254,0.2); }

    .search-btn, .voice-btn {
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      cursor:pointer;
      font-size:20px;
      padding:6px;
      line-height:1;
    }
    .search-btn { right:46px; }
    .voice-btn { right:10px; }

    .voice-btn.listening { color:red; animation: pulse 1s infinite; }
    @keyframes pulse { 0%{ transform: translateY(-50%) scale(1);} 50%{ transform: translateY(-50%) scale(1.16);} 100%{ transform: translateY(-50%) scale(1);} }

    .filters-wrapper{ display:flex; justify-content:center; margin-bottom:12px; gap:12px; align-items:center; }
    .filters-btn{ padding:10px 16px; font-weight:700; border-radius:10px; background:var(--accent); color:white; border:none; cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,0.12); }
    .filters-panel{ position:relative; }
    .filters-dropdown{
      display:none; position:absolute; top:44px; right:0; width:360px; background:white; border-radius:10px;
      box-shadow:0 18px 40px rgba(0,0,0,0.2); padding:12px; z-index:50;
    }
    .filters-dropdown.open{ display:block; }
    .filters-row{ display:flex; gap:8px; margin:8px 0; align-items:center; flex-wrap:wrap; }
    .filters-row label{ font-size:13px; color:#0b2b5a; font-weight:600; margin-right:6px; min-width:80px; }
    select, .small-input{ padding:8px 10px; border-radius:8px; border:1px solid #ddd; font-size:14px; }
    .small-input{ width:120px; }
    .checkbox-row{ display:flex; align-items:center; gap:8px; font-size:13px; color:#333; }
    .filters-actions{ display:flex; justify-content:space-between; margin-top:10px; gap:8px; }
    .btn{ padding:8px 12px; border-radius:8px; cursor:pointer; border:none; }
    .btn.apply{ background:var(--accent); color:white; font-weight:700; }
    .btn.clear{ background:#f1f1f1; color:#333; }

    /* Playlists grid (attractive centered cards) */
    .playlist-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap:20px;
      padding:10px 14px;
      justify-items:center;
    }
    .playlist-card{
      width:240px; background:rgba(255,255,255,0.95); border-radius:14px; overflow:hidden;
      text-decoration:none; color:inherit; box-shadow:0 8px 20px rgba(0,0,0,0.12);
      transition: transform .18s ease, box-shadow .18s ease; cursor:pointer;
    }
    .playlist-card:hover{ transform: translateY(-8px) scale(1.03); box-shadow:0 20px 40px rgba(0,0,0,0.18); }
    .playlist-thumb{ width:100%; height:150px; object-fit:cover; border-bottom:1px solid rgba(0,0,0,0.06); }
    .playlist-title{ padding:12px; font-weight:700; font-size:15px; text-align:center; color:#0b2b5a; }

    /* Sections & cards */
    .card{ background: rgba(255,255,255,0.58); border-radius:12px; padding:16px; margin-bottom:18px; box-shadow:0 10px 28px rgba(0,0,0,0.12); }
    h2{ margin:0 0 10px 0; color:#0b2b5a; }

    /* Video grid */
    .yt-grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:14px; }
    .yt-item{ background:rgba(255,255,255,0.95); border-radius:10px; overflow:hidden; text-decoration:none; color:inherit; box-shadow:0 8px 18px rgba(0,0,0,0.08); transition: transform .14s ease; }
    .yt-item:hover{ transform: translateY(-6px); }
    .yt-thumb{ width:100%; height:140px; object-fit:cover; display:block; }
    .yt-title{ padding:10px; font-weight:700; font-size:14px; }
    .yt-meta{ padding:0 10px 12px 10px; color:var(--muted); font-size:13px; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .badge-short{ display:inline-block; background:#111; color:#fff; font-weight:700; padding:6px 8px; border-radius:8px; font-size:12px; }

    /* Modal */
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999; background:rgba(0,0,0,0.6); padding:24px; }
    .modal .modal-content{ width:100%; max-width:1100px; max-height:86vh; overflow:auto; background:#fff; border-radius:12px; padding:16px; }
    .modal .close-btn{ float:right; cursor:pointer; font-weight:700; font-size:18px; }

    /* Search results badges */
    #searchResults .result-badge{ background:#0b2b5a; color:white; padding:4px 8px; border-radius:6px; font-size:11px; margin-left:6px; font-weight:bold; }

    .muted{ color:var(--muted); font-size:13px; }

    @media (max-width:820px){
      h1{ font-size:32px; }
      .logo,.photo{ width:110px; height:110px; }
      .filters-dropdown{ left:10px; right:10px; width:auto; }
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- Header -->
    <header>
      <img class="logo" src="https://raw.githubusercontent.com/abobby9/abobby9/main/Logo.png" alt="Logo">
      <div class="title-area">
        <h1>A Bobby Education 9</h1>
        <div class="subtitle">(Learn new things and increase your knowledge.)</div>

        <div class="social-buttons" aria-hidden>
          <a class="yt-btn" href="https://www.youtube.com/@ABobbyEducation9" target="_blank" rel="noopener">üì∫ Visit YouTube</a>
          <a class="ig-btn" href="https://www.instagram.com/abobbyeducation9/" target="_blank" rel="noopener">üì∑ Instagram</a>
        </div>
      </div>
      <img class="photo" src="https://raw.githubusercontent.com/abobby9/abobby9/main/Photo.png" alt="Photo">
    </header>

    <!-- Search + buttons -->
    <div class="search-container">
      <div class="search-box">
        <input id="searchInput" type="text" placeholder="Search everything... (Press Enter or click üîç)" oninput="onSearchInput()">
        <button class="search-btn" onclick="triggerSearch()" title="Search">üîç</button>
        <button class="voice-btn" onclick="startVoiceSearch()" title="Voice Search">üé§</button>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters-wrapper">
      <div class="filters-panel">
        <button class="filters-btn" id="filtersBtn">Filters ‚ñæ</button>
        <div class="filters-dropdown" id="filtersDropdown" aria-hidden="true">
          <!-- Playlist selector -->
          <div class="filters-row">
            <label>Playlist</label>
            <select id="filterPlaylist" class="small-input">
              <option value="__all">All playlists</option>
            </select>
          </div>

          <!-- Duration -->
          <div class="filters-row">
            <label>Duration</label>
            <select id="filterDuration" class="small-input">
              <option value="all">All</option>
              <option value="short">Short (‚â§60s)</option>
              <option value="medium">Medium (61‚Äì600s)</option>
              <option value="long">Long (>600s)</option>
            </select>
          </div>

          <!-- Year (auto) -->
          <div class="filters-row">
            <label>Year</label>
            <select id="filterYear" class="small-input">
              <option value="all">All</option>
            </select>
          </div>

          <!-- Title/Description -->
          <div class="filters-row">
            <label>Match</label>
            <div class="checkbox-row">
              <input type="checkbox" id="matchDescription" />
              <label for="matchDescription" style="font-weight:normal;">Title & Description</label>
            </div>
          </div>

          <!-- Sort -->
          <div class="filters-row">
            <label>Sort</label>
            <select id="filterSort" class="small-input">
              <option value="newest">Newest</option>
              <option value="oldest">Oldest</option>
              <option value="views">Most Viewed</option>
              <option value="alpha">Alphabetical</option>
            </select>
          </div>

          <div class="filters-actions">
            <button class="btn clear" id="clearFiltersBtn">Clear</button>
            <button class="btn apply" id="applyFiltersBtn">Apply</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Search Results -->
    <div id="searchResults" class="card" style="display:none;">
      <h2>Search Results</h2>
      <div id="resultsGrid" class="yt-grid"></div>
    </div>

    <!-- Playlists -->
    <section class="card" id="playlistsSection">
      <h2>Playlists</h2>
      <div id="playlistGrid" class="playlist-grid"></div>
      <div id="noPlaylists" class="muted" style="display:none;">No playlists found.</div>
    </section>

    <!-- All Videos -->
    <section class="card" id="allVideosSection">
      <h2>All Videos (including Shorts)</h2>
      <div id="allVideosGrid" class="yt-grid"></div>
      <div id="noVideos" class="muted" style="display:none;">No videos found.</div>
    </section>

    <!-- Like/Subscribe -->
    <section class="card">
      <h2 style="text-align:center;">Like, Subscribe and Share</h2>
    </section>

    <!-- Contact -->
    <section class="card">
      <h2>Contact</h2>
      <a class="contact-link" style="display:inline-block; text-decoration:none; padding:12px 16px; border-radius:10px; background:rgba(10,60,130,0.06); color:#0a376f;"
         href="https://docs.google.com/forms/d/e/1FAIpQLSdOpYn8VGVIslrUG5WpFYmh1StOrnCvBhNv2UJ1q4KHJNIplg/viewform" target="_blank">
         Click here to Contact
      </a>
    </section>

    <footer style="text-align:center; margin-top:8px; color:var(--muted);">
      ¬© <span id="year"></span> A Bobby Education 9
    </footer>

  </div>

  <!-- Playlist modal -->
  <div id="playlistModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 id="modalTitle" style="margin:0;"></h3>
        <div class="close-btn" id="closeModal" title="Close">‚úï</div>
      </div>
      <div id="modalVideos" style="margin-top:12px;" class="yt-grid"></div>
    </div>
  </div>

  <script>
    /***********************
     * Configuration
     ***********************/
    const API_KEY = "AIzaSyAlOvNpWfbUcIayhbC2IcK4vtsRjUdpPWg";
    const CHANNEL_ID = "UC7VwSQ40PUY2eMlLRADq-LQ";
    const UPLOADS_PLAYLIST_ID = CHANNEL_ID.replace(/^UC/, 'UU');

    /***********************
     * Global caches & state
     ***********************/
    const GLOBAL_DATA = { playlists: [], videos: [], playlistsMap: {} };
    let CURRENT_FILTERS = {
      playlistId: "__all",
      duration: "all",
      year: "all",
      matchDescription: false,
      sort: "newest",
      searchTerm: ""
    };

    /***********************
     * Helpers
     ***********************/
    function isoDurationToSeconds(iso) {
      if (!iso) return 0;
      const m = iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
      if (!m) return 0;
      const hours = parseInt(m[1]||0,10);
      const mins = parseInt(m[2]||0,10);
      const secs = parseInt(m[3]||0,10);
      return hours*3600 + mins*60 + secs;
    }
    function formatDuration(sec){
      if (!sec && sec !== 0) return '';
      const h = Math.floor(sec/3600); sec %= 3600;
      const m = Math.floor(sec/60); const s = sec % 60;
      if (h>0) return `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
      return `${m}:${String(s).padStart(2,'0')}`;
    }
    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    /***********************
     * UI helpers: cards
     ***********************/
    function createPlaylistCard(pl){
      const div = document.createElement('div');
      div.className = 'playlist-card';
      const thumb = pl.snippet.thumbnails?.medium?.url || pl.snippet.thumbnails?.default?.url || '';
      div.innerHTML = `
        <img class="playlist-thumb" src="${thumb}" alt="${escapeHtml(pl.snippet.title)}">
        <div class="playlist-title">${escapeHtml(pl.snippet.title)}</div>
      `;
      div.addEventListener('click', ()=> openPlaylist(pl.id, pl.snippet.title));
      return div;
    }

    function createVideoCard(video){
      const vid = video.id;
      const title = video.snippet.title;
      const thumb = video.snippet.thumbnails?.high?.url || video.snippet.thumbnails?.medium?.url || `https://img.youtube.com/vi/${vid}/hqdefault.jpg`;
      const channel = video.snippet.channelTitle || '';
      const durationIso = (video.contentDetails && video.contentDetails.duration) ? video.contentDetails.duration : null;
      const seconds = isoDurationToSeconds(durationIso);
      const isShort = (title.toLowerCase().includes('#shorts')) || (seconds > 0 && seconds <= 60);
      const viewCount = (video.statistics && video.statistics.viewCount) ? Number(video.statistics.viewCount) : 0;
      const published = video.snippet.publishedAt ? new Date(video.snippet.publishedAt) : null;
      const year = published ? published.getFullYear() : '';

      const a = document.createElement('a');
      a.className = 'yt-item';
      a.href = `https://www.youtube.com/watch?v=${vid}`;
      a.target = '_blank';
      a.rel = 'noopener';

      a.innerHTML = `
        <img class="yt-thumb" src="${thumb}" alt="${escapeHtml(title)}">
        <div class="yt-title">${escapeHtml(title)}</div>
        <div class="yt-meta">
          <span>${escapeHtml(channel)}</span>
          ${isShort ? '<span class="badge-short">SHORT</span>' : ''}
          ${durationIso ? `<span>‚Ä¢ ${formatDuration(seconds)}</span>` : ''}
          <span>‚Ä¢ ${year}</span>
          <span>‚Ä¢ ${viewCount.toLocaleString()} views</span>
        </div>
      `;
      return a;
    }

    /***********************
     * Fetch helpers
     ***********************/
    async function fetchJson(url){
      const res = await fetch(url);
      if(!res.ok) throw new Error('Network error: ' + res.status);
      return res.json();
    }

    async function fetchPlaylists(){
      const grid = document.getElementById('playlistGrid');
      grid.innerHTML = '<div class="muted">Loading playlists‚Ä¶</div>';
      try{
        const url = `https://www.googleapis.com/youtube/v3/playlists?part=snippet,contentDetails&channelId=${CHANNEL_ID}&maxResults=50&key=${API_KEY}`;
        const data = await fetchJson(url);
        GLOBAL_DATA.playlists = data.items || [];
        GLOBAL_DATA.playlists.forEach(pl => GLOBAL_DATA.playlistsMap[pl.id] = pl);
        grid.innerHTML = '';
        if(!GLOBAL_DATA.playlists.length){ document.getElementById('noPlaylists').style.display='block'; return; }
        GLOBAL_DATA.playlists.forEach(pl => grid.appendChild(createPlaylistCard(pl)));
        populatePlaylistSelect();
      }catch(err){
        console.error(err);
        grid.innerHTML = '<div class="muted">Could not load playlists.</div>';
      }
    }

    async function fetchAllUploads(){
      const grid = document.getElementById('allVideosGrid');
      grid.innerHTML = '<div class="muted">Loading videos‚Ä¶</div>';
      try{
        const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${UPLOADS_PLAYLIST_ID}&maxResults=50&key=${API_KEY}`;
        const data = await fetchJson(url);
        const videoIds = (data.items || []).map(i=> i.snippet.resourceId.videoId).filter(Boolean);
        const details = await fetchVideosDetails(videoIds);
        GLOBAL_DATA.videos = details;
        grid.innerHTML = '';
        if(!GLOBAL_DATA.videos.length){ document.getElementById('noVideos').style.display='block'; return; }
        GLOBAL_DATA.videos.forEach(v => grid.appendChild(createVideoCard(v)));
        populateYearSelect();
      }catch(err){
        console.error(err);
        grid.innerHTML = '<div class="muted">Could not load videos.</div>';
      }
    }

    async function fetchVideosDetails(ids){
      if(!ids || ids.length===0) return [];
      const batches = [];
      for(let i=0;i<ids.length;i+=50) batches.push(ids.slice(i,i+50));
      const out = [];
      for(const batch of batches){
        const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics&id=${batch.join(',')}&maxResults=50&key=${API_KEY}`;
        try{
          const data = await fetchJson(url);
          if(data.items) out.push(...data.items);
        }catch(err){
          console.error('videos.list failed', err);
        }
      }
      return out;
    }

    async function fetchPlaylistVideos(playlistId){
      try{
        const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${playlistId}&maxResults=50&key=${API_KEY}`;
        const data = await fetchJson(url);
        const ids = (data.items||[]).map(i=>i.snippet.resourceId.videoId).filter(Boolean);
        const details = await fetchVideosDetails(ids);
        return details;
      }catch(err){
        console.error(err);
        return [];
      }
    }

    /***********************
     * Populate selects
     ***********************/
    function populatePlaylistSelect(){
      const sel = document.getElementById('filterPlaylist');
      sel.innerHTML = '<option value="__all">All playlists</option>';
      GLOBAL_DATA.playlists.forEach(pl=>{
        const opt = document.createElement('option'); opt.value = pl.id; opt.textContent = pl.snippet.title; sel.appendChild(opt);
      });
    }

    function populateYearSelect(){
      const sel = document.getElementById('filterYear');
      sel.innerHTML = '<option value="all">All</option>';
      const years = new Set();
      GLOBAL_DATA.videos.forEach(v=>{
        if(v.snippet && v.snippet.publishedAt) years.add(new Date(v.snippet.publishedAt).getFullYear());
      });
      const arr = Array.from(years).sort((a,b)=>b-a);
      arr.forEach(y=>{ const opt = document.createElement('option'); opt.value = String(y); opt.textContent = String(y); sel.appendChild(opt); });
    }

    /***********************
     * Playlist modal
     ***********************/
    const modal = document.getElementById('playlistModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalVideos = document.getElementById('modalVideos');
    const closeModalBtn = document.getElementById('closeModal');

    async function openPlaylist(playlistId, playlistTitle){
      modalTitle.textContent = playlistTitle;
      modalVideos.innerHTML = '<div class="muted">Loading playlist videos‚Ä¶</div>';
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden','false');
      const details = await fetchPlaylistVideos(playlistId);
      modalVideos.innerHTML = '';
      if(!details.length){ modalVideos.innerHTML = '<div class="muted">No videos in playlist.</div>'; return; }
      details.forEach(v => modalVideos.appendChild(createVideoCard(v)));
    }
    function closeModal(){ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); modalVideos.innerHTML=''; }
    closeModalBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=> { if(e.target === modal) closeModal(); });

    /***********************
     * Search & Filters logic
     ***********************/
    function debounce(fn, wait=300){ let t; return (...args)=>{ clearTimeout(t); t = setTimeout(()=>fn.apply(this,args), wait); }; }

    // Called while typing
    const onSearchInput = debounce(()=>{
      const term = document.getElementById('searchInput').value.trim();
      CURRENT_FILTERS.searchTerm = term;
      applyFiltersAndShowResults();
    }, 350);

    // Enter key search
    document.addEventListener('keydown', function(e){
      if(e.key === "Enter" && document.activeElement && document.activeElement.id === "searchInput"){
        e.preventDefault();
        const term = document.getElementById('searchInput').value.trim();
        CURRENT_FILTERS.searchTerm = term;
        applyFiltersAndShowResults();
      }
    });

    // Trigger search from search icon
    function triggerSearch(){
      const term = document.getElementById('searchInput').value.trim();
      CURRENT_FILTERS.searchTerm = term;
      applyFiltersAndShowResults();
    }

    // Voice search
    function startVoiceSearch(){
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) { alert("Voice search is not supported in this browser."); return; }

      const recognition = new SpeechRecognition();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      const voiceBtn = document.querySelector(".voice-btn");

      recognition.onstart = () => { voiceBtn.classList.add("listening"); };
      recognition.onend = () => { voiceBtn.classList.remove("listening"); };
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById("searchInput").value = transcript;
        CURRENT_FILTERS.searchTerm = transcript;
        applyFiltersAndShowResults();
      };

      recognition.start();
    }

    // Apply filters and search
    async function applyFiltersAndShowResults(){
      const resultsGrid = document.getElementById('resultsGrid');
      resultsGrid.innerHTML = '<div class="muted">Searching‚Ä¶</div>';
      document.getElementById('searchResults').style.display = 'block';

      // Source videos: uploads or selected playlist
      let sourceVideos = GLOBAL_DATA.videos.slice();
      if(CURRENT_FILTERS.playlistId && CURRENT_FILTERS.playlistId !== '__all'){
        sourceVideos = await fetchPlaylistVideos(CURRENT_FILTERS.playlistId);
      }

      const term = (CURRENT_FILTERS.searchTerm || '').toLowerCase().trim();
      const matchDesc = CURRENT_FILTERS.matchDescription;

      let filtered = sourceVideos.filter(v=>{
        if(!v || !v.snippet) return false;
        const title = v.snippet.title.toLowerCase();
        const desc = (v.snippet.description || '').toLowerCase();
        if(term){
          if(matchDesc) return title.includes(term) || desc.includes(term);
          return title.includes(term);
        }
        return true;
      });

      // Duration filter
      filtered = filtered.filter(v=>{
        const d = isoDurationToSeconds(v.contentDetails?.duration || '');
        if(CURRENT_FILTERS.duration === 'all') return true;
        if(CURRENT_FILTERS.duration === 'short') return d>0 && d<=60;
        if(CURRENT_FILTERS.duration === 'medium') return d>60 && d<=600;
        if(CURRENT_FILTERS.duration === 'long') return d>600;
        return true;
      });

      // Year filter
      if(CURRENT_FILTERS.year && CURRENT_FILTERS.year !== 'all'){
        filtered = filtered.filter(v=>{
          const pub = v.snippet.publishedAt ? new Date(v.snippet.publishedAt).getFullYear() : '';
          return String(pub) === String(CURRENT_FILTERS.year);
        });
      }

      // Sorting
      if(CURRENT_FILTERS.sort === 'newest'){
        filtered.sort((a,b)=> new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));
      } else if(CURRENT_FILTERS.sort === 'oldest'){
        filtered.sort((a,b)=> new Date(a.snippet.publishedAt) - new Date(b.snippet.publishedAt));
      } else if(CURRENT_FILTERS.sort === 'views'){
        filtered.sort((a,b)=> (Number(b.statistics?.viewCount||0) - Number(a.statistics?.viewCount||0)));
      } else if(CURRENT_FILTERS.sort === 'alpha'){
        filtered.sort((a,b)=> a.snippet.title.localeCompare(b.snippet.title));
      }

      // Render
      resultsGrid.innerHTML = '';
      if(!filtered.length){ resultsGrid.innerHTML = '<div class="muted">No results match your filters.</div>'; return; }
      filtered.forEach(v => resultsGrid.appendChild(createVideoCard(v)));
    }

    /***********************
     * Filters panel interactions
     ***********************/
    const filtersBtn = document.getElementById('filtersBtn');
    const filtersDropdown = document.getElementById('filtersDropdown');
    const applyBtn = document.getElementById('applyFiltersBtn');
    const clearBtn = document.getElementById('clearFiltersBtn');

    filtersBtn.addEventListener('click', ()=> {
      const open = filtersDropdown.classList.toggle('open');
      filtersDropdown.setAttribute('aria-hidden', open ? 'false' : 'true');
    });

    document.addEventListener('click', (e)=>{
      if(!filtersDropdown.contains(e.target) && e.target !== filtersBtn){
        filtersDropdown.classList.remove('open'); filtersDropdown.setAttribute('aria-hidden','true');
      }
    });

    applyBtn.addEventListener('click', ()=> {
      CURRENT_FILTERS.playlistId = document.getElementById('filterPlaylist').value || '__all';
      CURRENT_FILTERS.duration = document.getElementById('filterDuration').value || 'all';
      CURRENT_FILTERS.year = document.getElementById('filterYear').value || 'all';
      CURRENT_FILTERS.matchDescription = document.getElementById('matchDescription').checked;
      CURRENT_FILTERS.sort = document.getElementById('filterSort').value || 'newest';
      filtersDropdown.classList.remove('open'); filtersDropdown.setAttribute('aria-hidden','true');
      applyFiltersAndShowResults();
    });

    clearBtn.addEventListener('click', ()=> {
      document.getElementById('filterPlaylist').value = '__all';
      document.getElementById('filterDuration').value = 'all';
      document.getElementById('filterYear').value = 'all';
      document.getElementById('matchDescription').checked = false;
      document.getElementById('filterSort').value = 'newest';
      CURRENT_FILTERS = { playlistId: "__all", duration: "all", year: "all", matchDescription: false, sort: "newest", searchTerm: CURRENT_FILTERS.searchTerm || "" };
      applyFiltersAndShowResults();
    });

    /***********************
     * Init sequence
     ***********************/
    (async function init(){
      document.getElementById('year').textContent = new Date().getFullYear();
      await fetchPlaylists();
      await fetchAllUploads();
      document.getElementById('searchResults').style.display = 'none';
    })();

  </script>
</body>
</html>
